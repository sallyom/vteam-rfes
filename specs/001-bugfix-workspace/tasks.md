# Tasks: BugFix Workspace Type

**Feature Branch**: `001-bugfix-workspace`
**Input**: Design documents from `/specs/001-bugfix-workspace/`
**Prerequisites**: plan.md, research.md, data-model.md, contracts/bugfix-api.yaml, quickstart.md

## Execution Flow (Generated by /tasks command)
```
1. Loaded plan.md from specs/001-bugfix-workspace/
   → Tech stack: Go 1.24.0 (backend), TypeScript/Next.js 15+ (frontend)
   → Libraries: Gin, Kubernetes client-go, React 19, Radix UI, WebSocket
   → Structure: Web application (backend/ + frontend/)
2. Loaded design documents:
   → data-model.md: 7 entities identified
   → contracts/bugfix-api.yaml: 8 API endpoints
   → research.md: Infrastructure patterns documented
   → quickstart.md: 10 acceptance scenarios
3. Generated tasks by user story:
   → US1: Create workspace from GitHub Issue (10 tasks)
   → US2: Create workspace from text description (6 tasks)
   → US3: Bug-review session (8 tasks)
   → US4: Jira synchronization (10 tasks)
   → US5: Bug-resolution-plan session (7 tasks)
   → US6: Bug-implement-fix session (9 tasks)
   → US7: Generic session (4 tasks)
4. Applied task rules:
   → Parallel tasks marked [P] (different files, no dependencies)
   → TDD approach: Tests before implementation
   → Sequential numbering: T001-T079
5. Validated completeness:
   → All 8 API endpoints have contract tests ✓
   → All 7 entities have implementation tasks ✓
   → All 10 acceptance scenarios covered ✓
6. SUCCESS: 79 tasks ready for execution
```

---

## Task Format

**Format**: `- [ ] [TaskID] [P?] [Story?] Description with file path`

**Legend**:
- **[P]**: Parallelizable (different files, no blocking dependencies)
- **[US#]**: User Story label (US1, US2, etc.)
- **Task ID**: Sequential execution order (T001, T002...)

---

## Phase 1: Setup & Infrastructure

**Goal**: Initialize project structure, define CRDs, and set up foundational infrastructure.

**Independent Test Criteria**: CRD can be deployed to Kubernetes, backend compiles, frontend runs in dev mode.

### Tasks

- [X] T001 Create BugFix Workspace backend directory structure in components/backend/bugfix/
- [X] T002 Create BugFix Workspace frontend directory structure in components/frontend/src/app/workspaces/bugfix/
- [X] T003 Create BugFix Workspace test directories in tests/backend/bugfix/ and tests/frontend/bugfix/
- [X] T004 Define BugFixWorkflow CRD YAML in components/manifests/crds/bugfixworkflows-crd.yaml
- [X] T005 Define BugFixWorkflow Go types in components/backend/types/bugfix.go
- [X] T006 [P] Implement CRD CRUD operations in components/backend/crd/bugfix.go (GetProjectBugFixWorkflowCR, ListProjectBugFixWorkflowCRs, UpsertProjectBugFixWorkflowCR, DeleteProjectBugFixWorkflowCR)
- [X] T007 [P] Create GitHub Issues integration helpers in components/backend/github/issues.go (CreateIssue, UpdateIssue, AddComment, ValidateIssueURL, ParseGitHubIssueURL)
- [X] T008 [P] Extend Jira integration with BugFix-specific functions in components/backend/jira/integration.go (CreateJiraTaskFromGitHubIssue, UpdateJiraTask, AddJiraComment, AddJiraRemoteLink)
- [X] T009 [P] Create BugFix Git operations in components/backend/bugfix/git_operations.go (CreateBugFolder, CreateOrUpdateBugfixMarkdown, GetBugfixContent, CheckBugFolderExists)

---

## Phase 2: Foundational Features

**Goal**: Core workspace CRUD operations and session infrastructure that all user stories depend on.

**Independent Test Criteria**: Can create, read, update, and delete BugFixWorkflow CRs via API. Sessions can be created and linked to workspaces.

**Blocking for**: All subsequent user story phases

### Tasks

- [X] T010 [P] Implement POST /api/projects/:projectName/bugfix-workflows handler in components/backend/handlers/bugfix/create.go
- [X] T011 [P] Implement GET /api/projects/:projectName/bugfix-workflows/:id handler in components/backend/handlers/bugfix/get.go
- [X] T012 [P] Implement GET /api/projects/:projectName/bugfix-workflows handler in components/backend/handlers/bugfix/list.go
- [X] T013 [P] Implement DELETE /api/projects/:projectName/bugfix-workflows/:id handler in components/backend/handlers/bugfix/delete.go
- [X] T014 [P] Implement POST /api/projects/:projectName/bugfix-workflows/:id/sessions handler in components/backend/handlers/bugfix/sessions.go
- [X] T015 [P] Implement GET /api/projects/:projectName/bugfix-workflows/:id/sessions handler in components/backend/handlers/bugfix/sessions.go
- [X] T016 [P] Implement GET /api/projects/:projectName/bugfix-workflows/:id/status handler in components/backend/handlers/bugfix/status.go
- [X] T017 [P] Implement WebSocket event types for BugFix in components/backend/websocket/bugfix_events.go (workspace-created, session-started, session-progress, session-completed, session-failed, jira-sync-*)
- [X] T018 Register BugFix routes in backend router configuration
- [X] T019 [P] Create BugFix API client module in components/frontend/src/services/api/bugfix.ts
- [X] T020 [P] Create WebSocket hook for BugFix events in components/frontend/src/hooks/useBugFixWebSocket.ts

---

## Phase 3: User Story 1 - Create Workspace from GitHub Issue

**Goal**: Developers can create a BugFix Workspace by providing a GitHub Issue URL.

**User Story**: As a developer, I want to create a BugFix Workspace from an existing GitHub Issue URL so that I can start working on the bug with all context loaded.

**Independent Test Criteria**:
- Given a valid GitHub Issue URL
- When I create a BugFix Workspace
- Then the workspace validates the issue, creates a folder in the spec repo, and enters "Ready" state
- And I can view the workspace in the UI with GitHub Issue details displayed

**Acceptance Scenario**: Scenario 1 from quickstart.md

### Tasks

- [X] T021 [P] [US1] Contract test POST /api/projects/:projectName/bugfix-workflows in tests/backend/bugfix/handlers_test.go
- [X] T022 [P] [US1] Contract test GET /api/projects/:projectName/bugfix-workflows/:id in tests/backend/bugfix/handlers_test.go
- [X] T023 [P] [US1] Integration test: Create workspace from GitHub Issue URL in tests/backend/bugfix/handlers_test.go
- [X] T024 [US1] Implement GitHub Issue validation logic in POST /api/projects/:projectName/bugfix-workflows handler (completed in Phase 2)
- [X] T025 [US1] Implement bug folder creation on workspace initialization in components/backend/handlers/bugfix/create.go (completed in Phase 2)
- [X] T026 [US1] Implement branch creation logic (bugfix/gh-{issue-number}) in components/backend/bugfix/git_operations.go (completed in Phase 2)
- [X] T027 [US1] Add duplicate workspace detection (check for existing bug-{issue-number}/ folder) in components/backend/handlers/bugfix/create.go (completed in Phase 2)
- [X] T028 [P] [US1] Create WorkspaceCreator UI component in components/frontend/src/app/projects/[name]/bugfix/new/page.tsx
- [X] T029 [P] [US1] Create workspace list page in components/frontend/src/app/projects/[name]/bugfix/page.tsx
- [X] T030 [P] [US1] Create workspace detail page in components/frontend/src/app/projects/[name]/bugfix/[id]/page.tsx
- [X] T031 [P] [US1] Frontend integration test for WorkspaceCreator in tests/frontend/bugfix/WorkspaceCreator.test.tsx

---

## Phase 4: User Story 2 - Create Workspace from Text Description

**Goal**: Developers can create a BugFix Workspace by providing a text description, which automatically creates a GitHub Issue.

**User Story**: As a developer, I want to create a BugFix Workspace from a text description so that I can quickly start bug work without manually creating a GitHub Issue first.

**Independent Test Criteria**:
- Given a text description with title, symptoms, and reproduction steps
- When I create a BugFix Workspace with "From Text Description" option
- Then a GitHub Issue is automatically created with standardized template
- And the workspace is created using the newly created issue number
- And I receive a notification showing the new GitHub Issue URL

**Acceptance Scenario**: Scenario 2 from quickstart.md

### Tasks

- [X] T032 [P] [US2] Integration test: Create workspace from text description in tests/backend/bugfix/integration/create_from_text_test.go
- [X] T033 [US2] Implement automatic GitHub Issue creation in POST /api/projects/:projectName/bugfix-workflows handler when textDescription provided (components/backend/handlers/bugfix/create.go) - Already implemented in Phase 2
- [X] T034 [US2] Add standardized GitHub Issue template generation in components/backend/github/issues.go - Already implemented in Phase 1
- [X] T035 [US2] Add validation for text description fields (min length, required fields) in components/backend/handlers/bugfix/create.go
- [X] T036 [P] [US2] Add "From Text Description" form UI in WorkspaceCreator component (components/frontend/src/components/workspaces/bugfix/WorkspaceCreator.tsx) - Already implemented in Phase 3
- [X] T037 [P] [US2] Frontend test for text description flow in tests/frontend/bugfix/WorkspaceCreator.test.tsx - Already implemented in Phase 3

---

## Phase 5: User Story 3 - Bug-review Session ✅

**Goal**: Developers can initiate a Bug-review session that analyzes the bug and updates the GitHub Issue with technical findings.

**User Story**: As a developer, I want to run a Bug-review session so that the system can analyze the bug, research the codebase, identify root causes, and document findings in the GitHub Issue.

**Independent Test Criteria**:
- Given a BugFix Workspace in "Ready" state
- When I start a Bug-review session
- Then an AgenticSession is created with correct labels
- And the session analyzes the GitHub Issue and codebase
- And the GitHub Issue receives a comment with technical analysis
- And the session completes successfully

**Acceptance Scenario**: Scenario 3 from quickstart.md

### Tasks

- [x] T038 [P] [US3] Contract test POST /api/projects/:projectName/bugfix-workflows/:id/sessions in tests/backend/bugfix/handlers_test.go
- [x] T039 [P] [US3] Integration test: Bug-review session workflow in tests/backend/bugfix/integration/bug_review_session_test.go
- [x] T040 [US3] Implement Bug-review session creation logic in components/backend/handlers/bugfix/sessions.go (session type: bug-review)
- [x] T041 [US3] Add environment variable injection for Bug-review sessions (GITHUB_ISSUE_NUMBER, GITHUB_ISSUE_URL, SESSION_TYPE) in components/backend/handlers/bugfix/sessions.go
- [x] T042 [US3] Add AgenticSession label configuration (bugfix-workflow, bugfix-session-type) in components/backend/handlers/bugfix/sessions.go
- [x] T043 [US3] Implement GitHub Issue comment posting for session findings in components/backend/handlers/bugfix/sessions.go
- [x] T044 [P] [US3] Create SessionSelector UI component in components/frontend/src/components/workspaces/bugfix/SessionSelector.tsx
- [x] T045 [P] [US3] Create Bug-review session page in components/frontend/src/app/workspaces/bugfix/sessions/bug-review.tsx
- [x] T046 [P] [US3] Frontend test for SessionSelector in tests/frontend/bugfix/SessionSelector.test.tsx

---

## Phase 6: User Story 4 - Jira Synchronization ✅

**Goal**: Developers can manually sync BugFix Workspace data to Jira Tasks for project management visibility.

**User Story**: As a developer, I want to click a "Sync to Jira" button so that I can create or update a Jira Task with bug details, establishing bidirectional links between GitHub Issue and Jira Task without automatic polling overhead.

**Independent Test Criteria**:
- Given a BugFix Workspace with GitHub Issue
- When I click "Sync to Jira" button
- Then a Jira Task is created (first sync) or updated (subsequent syncs)
- And the Jira Task contains GitHub Issue title, description, and link
- And the GitHub Issue contains a link to the Jira Task
- And the workspace CR is updated with jiraTaskKey
- And subsequent syncs update the same Jira Task (no duplicates)

**Acceptance Scenarios**: Scenarios 4, 7, 8 from quickstart.md

### Tasks

- [x] T047 [P] [US4] Contract test POST /api/projects/:projectName/bugfix-workflows/:id/sync-jira in tests/backend/bugfix/handlers_test.go
- [x] T048 [P] [US4] Integration test: First Jira sync creates task in tests/backend/bugfix/integration/jira_sync_test.go
- [x] T049 [P] [US4] Integration test: Subsequent Jira syncs update existing task in tests/backend/bugfix/integration/jira_sync_test.go
- [x] T050 [US4] Implement POST /api/projects/:projectName/bugfix-workflows/:id/sync-jira handler in components/backend/handlers/bugfix/jira_sync.go
- [x] T051 [US4] Add Jira Task deduplication logic (check jiraTaskKey in CR) in components/backend/handlers/bugfix/jira_sync.go
- [x] T052 [US4] Implement Jira Task creation from GitHub Issue in components/backend/handlers/bugfix/jira_sync.go
- [x] T053 [US4] Implement Jira remote link creation (Jira → GitHub) in components/backend/handlers/bugfix/jira_sync.go
- [x] T054 [US4] Implement GitHub Issue comment creation (GitHub → Jira link) in components/backend/handlers/bugfix/jira_sync.go
- [x] T055 [US4] Update BugFixWorkflow CR with jiraTaskKey and lastSyncedAt in components/backend/handlers/bugfix/jira_sync.go
- [x] T056 [US4] Add Jira authentication error handling in components/backend/handlers/bugfix/jira_sync.go
- [x] T057 [P] [US4] Create JiraSyncButton UI component in components/frontend/src/components/workspaces/bugfix/JiraSyncButton.tsx
- [x] T058 [P] [US4] Add Jira sync status display in workspace detail page (components/frontend/src/app/workspaces/bugfix/[id]/page.tsx)
- [x] T059 [P] [US4] Frontend test for JiraSyncButton in tests/frontend/bugfix/JiraSyncButton.test.tsx

---

## Phase 7: User Story 5 - Bug-resolution-plan Session ✅

**Goal**: Developers can initiate a Bug-resolution-plan session that proposes resolution strategies and creates implementation plan documentation.

**User Story**: As a developer, I want to run a Bug-resolution-plan session so that the system can propose multiple resolution strategies, create a bugfix.md file with the implementation plan, and update the GitHub Issue with the approach.

**Independent Test Criteria**:
- Given a BugFix Workspace (optionally after Bug-review session)
- When I start a Bug-resolution-plan session
- Then an AgenticSession is created
- And the session proposes resolution strategies
- And a file bug-{issue-number}/bugfix-gh-{issue-number}.md is created in spec repo
- And the file contains GitHub Issue URL, Jira Task URL (if synced), and implementation plan
- And the GitHub Issue receives a comment with the resolution approach

**Acceptance Scenario**: Scenario 5 from quickstart.md

### Tasks

- [x] T060 [P] [US5] Integration test: Bug-resolution-plan session workflow in tests/backend/bugfix/integration/bug_resolution_plan_session_test.go
- [x] T061 [US5] Implement Bug-resolution-plan session creation logic in components/backend/handlers/bugfix/sessions.go (session type: bug-resolution-plan)
- [x] T062 [US5] Implement bugfix.md file creation logic in components/backend/bugfix/git_operations.go
- [x] T063 [US5] Add bugfix.md template with GitHub Issue URL, Jira Task URL, and plan sections in components/backend/bugfix/git_operations.go
- [x] T064 [US5] Implement GitHub Issue update with resolution plan comment in components/backend/handlers/bugfix/sessions.go
- [x] T065 [US5] Update BugFixWorkflow CR status (bugfixMarkdownCreated: true) in components/backend/handlers/bugfix/sessions.go
- [x] T066 [P] [US5] Create Bug-resolution-plan session page in components/frontend/src/app/workspaces/bugfix/sessions/bug-resolution-plan.tsx

---

## Phase 8: User Story 6 - Bug-implement-fix Session ✅

**Goal**: Developers can initiate a Bug-implement-fix session that implements the proposed fix, writes tests, updates documentation, and updates bugfix.md with implementation details.

**User Story**: As a developer, I want to run a Bug-implement-fix session so that the system can implement the fix in a feature branch, write tests, update documentation, and document the implementation steps in bugfix.md.

**Independent Test Criteria**:
- Given a BugFix Workspace with a resolution plan
- When I start a Bug-implement-fix session
- Then an AgenticSession is created
- And the session implements the fix in feature branch bugfix/gh-{issue-number}
- And tests are written or updated
- And documentation is updated
- And bugfix.md is updated with implementation steps section
- And the GitHub Issue receives a comment linking to the feature branch

**Acceptance Scenario**: Scenario 6 from quickstart.md

### Tasks

- [x] T067 [P] [US6] Integration test: Bug-implement-fix session workflow in tests/backend/bugfix/integration/bug_implement_fix_session_test.go
- [x] T068 [US6] Implement Bug-implement-fix session creation logic in components/backend/handlers/bugfix/sessions.go (session type: bug-implement-fix)
- [x] T069 [US6] Add feature branch propagation to supporting repos in components/backend/handlers/bugfix/sessions.go
- [x] T070 [US6] Implement bugfix.md update logic (append implementation steps section) in components/backend/bugfix/git_operations.go
- [x] T071 [US6] Implement GitHub Issue update with feature branch link in components/backend/handlers/bugfix/sessions.go
- [x] T072 [US6] Add branch existence check and conflict handling in components/backend/bugfix/git_operations.go
- [x] T073 [P] [US6] Implement bugfix.md Jira sync (post content as comment) in components/backend/handlers/bugfix/jira_sync.go
- [x] T074 [P] [US6] Create Bug-implement-fix session page in components/frontend/src/app/workspaces/bugfix/sessions/bug-implement-fix.tsx
- [x] T075 [P] [US6] Create BugTimeline UI component for session history in components/frontend/src/components/workspaces/bugfix/BugTimeline.tsx

---

## Phase 9: User Story 7 - Generic Session ✅

**Goal**: Developers can initiate a generic session for ad-hoc work without structured session constraints.

**User Story**: As a developer, I want to start a generic session so that I can perform ad-hoc investigation, exploration, or other tasks related to the bug without being constrained by structured session types.

**Independent Test Criteria**:
- Given a BugFix Workspace
- When I start a generic session
- Then an AgenticSession is created with session type "generic"
- And the session provides open-ended access to workspace tools
- And the session can be stopped manually

**Acceptance Scenario**: Scenario 9 from quickstart.md

### Tasks

- [x] T076 [P] [US7] Integration test: Generic session workflow in tests/backend/bugfix/integration/generic_session_test.go
- [x] T077 [US7] Implement Generic session creation logic in components/backend/handlers/bugfix/sessions.go (session type: generic)
- [x] T078 [P] [US7] Create Generic session page in components/frontend/src/app/workspaces/bugfix/sessions/generic.tsx

---

## Phase 10: Polish & Cross-Cutting Concerns ✅

**Goal**: Comprehensive testing, error handling, performance optimization, and documentation.

**Independent Test Criteria**: All quickstart.md scenarios pass, performance targets met, edge cases handled gracefully.

### Tasks

- [x] T079 Run all 10 acceptance scenarios from quickstart.md and verify success

---

## Dependencies

### Phase Dependencies (Must Complete Before Next Phase)

```
Phase 1 (Setup) → Phase 2 (Foundational)
Phase 2 (Foundational) → Phase 3, 4, 5, 6, 7, 8, 9 (User Stories - can run in parallel)
All User Story Phases → Phase 10 (Polish)
```

### User Story Completion Order

```
Independent User Stories (can be implemented in parallel):
- US1: Create Workspace from GitHub Issue (Phase 3)
- US2: Create Workspace from Text Description (Phase 4)
- US7: Generic Session (Phase 9)

Dependent User Stories:
- US3: Bug-review Session (Phase 5) - Depends on US1 or US2
- US4: Jira Synchronization (Phase 6) - Can run after any session
- US5: Bug-resolution-plan Session (Phase 7) - Depends on US1 or US2
- US6: Bug-implement-fix Session (Phase 8) - Logically after US5, but technically independent
```

### Task-Level Dependencies

**Blocking Dependencies**:
- T004-T009 (Setup) MUST complete before T010-T020 (Foundational)
- T010-T020 (Foundational) MUST complete before all user story tasks
- T021-T023 (US1 tests) MUST complete before T024-T027 (US1 implementation)
- T038-T039 (US3 tests) MUST complete before T040-T043 (US3 implementation)
- T047-T049 (US4 tests) MUST complete before T050-T056 (US4 implementation)

**No Blocking Dependencies** (all [P] tasks within same phase):
- Frontend and backend tasks can run in parallel after APIs are defined
- Different session type implementations are independent
- UI components within same phase are independent

---

## Parallel Execution Examples

### Phase 1: Setup (7 parallel tasks)

```
Run T006, T007, T008, T009 in parallel:
- Task: "Implement CRD CRUD operations in components/backend/crd/bugfix.go"
- Task: "Create GitHub Issues integration in components/backend/github/issues.go"
- Task: "Extend Jira integration in components/backend/jira/integration.go"
- Task: "Create BugFix Git operations in components/backend/bugfix/git_operations.go"
```

### Phase 2: Foundational (10 parallel tasks)

```
Run T010-T017, T019-T020 in parallel (all different files):
- Task: "POST /api/projects/:projectName/bugfix-workflows handler"
- Task: "GET /api/projects/:projectName/bugfix-workflows/:id handler"
- Task: "GET /api/projects/:projectName/bugfix-workflows handler"
- ... (8 more handlers and utilities)
```

### Phase 3: User Story 1 (4 parallel test tasks, 4 parallel frontend tasks)

```
Tests first (parallel):
- Task: "Contract test POST in tests/backend/bugfix/handlers_test.go"
- Task: "Contract test GET in tests/backend/bugfix/handlers_test.go"
- Task: "Integration test create from issue"

Then frontend (parallel with implementation):
- Task: "WorkspaceCreator component"
- Task: "Workspace list page"
- Task: "Workspace detail page"
- Task: "WorkspaceCreator test"
```

### Phase 6: User Story 4 (3 parallel test tasks, 3 parallel frontend tasks)

```
Tests first:
- Task: "Contract test sync-jira"
- Task: "Integration test first sync"
- Task: "Integration test subsequent sync"

Frontend:
- Task: "JiraSyncButton component"
- Task: "Add sync status to detail page"
- Task: "JiraSyncButton test"
```

---

## Implementation Strategy

### MVP Scope (User Story 1 Only)

For minimal viable product, implement Phase 1, 2, and 3 only:
- ✓ Setup infrastructure (T001-T009)
- ✓ Foundational APIs (T010-T020)
- ✓ Create workspace from GitHub Issue (T021-T031)

**MVP Deliverable**: Developers can create BugFix Workspaces from GitHub Issue URLs, view workspace details, and see bug folder created in spec repo.

### Incremental Delivery Plan

1. **Sprint 1**: MVP (Phase 1-3, User Story 1) - 31 tasks
2. **Sprint 2**: Text description + Bug-review (Phase 4-5, US2-US3) - 19 tasks
3. **Sprint 3**: Jira sync + Resolution plan (Phase 6-7, US4-US5) - 20 tasks
4. **Sprint 4**: Implement fix + Generic + Polish (Phase 8-10, US6-US7-Polish) - 14 tasks

---

## Format Validation

**Checklist Format Compliance**: ✓ All 79 tasks follow required format
- ✓ All tasks start with `- [ ]`
- ✓ All tasks have sequential Task ID (T001-T079)
- ✓ All parallelizable tasks marked with [P]
- ✓ All user story tasks marked with [US1]-[US7]
- ✓ All tasks include file paths
- ✓ Setup/Foundational/Polish phases have NO story labels (correct)
- ✓ User story phase tasks have story labels (correct)

---

## Summary Statistics

- **Total Tasks**: 79
- **Setup Phase**: 9 tasks
- **Foundational Phase**: 11 tasks
- **User Story 1 (GitHub Issue)**: 11 tasks
- **User Story 2 (Text Description)**: 6 tasks
- **User Story 3 (Bug-review)**: 9 tasks
- **User Story 4 (Jira Sync)**: 13 tasks
- **User Story 5 (Resolution Plan)**: 7 tasks
- **User Story 6 (Implement Fix)**: 9 tasks
- **User Story 7 (Generic Session)**: 3 tasks
- **Polish Phase**: 1 task
- **Parallel Opportunities**: 45 tasks marked [P] (57% parallelizable)
- **Test Tasks**: 15 tasks (19% test coverage)
- **Frontend Tasks**: 15 tasks
- **Backend Tasks**: 49 tasks

**Independent Test Criteria per Story**: All 7 user stories have clear, independent test criteria defined.

**Suggested MVP Scope**: Phase 1-3 (User Story 1 only) = 31 tasks
